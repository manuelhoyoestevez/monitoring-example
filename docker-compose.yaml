version: '3.1'

services:
  me-rabbitmq:
    image: "rabbitmq:3.8.19-management"
    container_name: "me-rabbitmq"
    hostname: "me-rabbitmq"
    environment:
      SERVICE_NAME: "me-rabbitmq"
      RABBITMQ_ERLANG_COOKIE: "SWQOKODSQALRPCLNMEQG"
      RABBITMQ_DEFAULT_USER: "rabbitmq"
      RABBITMQ_DEFAULT_PASS: "rabbitmq"
      RABBITMQ_DEFAULT_VHOST: "/"
    expose:
      - 5671
      - 5672
      - 15672
    ports:
      - 5671:5671
      - 5672:5672
      - 15672:15672

  me-influxdb:
    image: "influxdb:1.8.6"
    container_name: "me-influxdb"
    hostname: "me-influxdb"
    environment:
      SERVICE_NAME: "me-influxdb"
      INFLUXDB_CONFIG_PATH: "/etc/influxdb/influxdb.conf"
      INFLUXDB_ADMIN_USER: admin
      INFLUXDB_ADMIN_PASSWORD: admin123
    volumes:
      - ./influxdb-data:/var/lib/influxdb
      - ./influxdb.conf:/etc/influxdb/influxdb.conf:ro
      - ./setup.iql:/docker-entrypoint-initdb.d/setup.iql:ro
    expose:
      - 8086
    ports:
      - 8086:8086
      - 8088:8088

  me-telegraf-consumer:
    image: "telegraf:1.19.1"
    container_name: "me-telegraf-consumer"
    hostname: "me-telegraf-consumer"
    environment:
      SERVICE_NAME: "me-telegraf-consumer"
    volumes:
      - ./telegraf-consumer.conf:/etc/telegraf/telegraf.conf:ro
    depends_on:
      - me-influxdb
      - me-rabbitmq

  me-telegraf-producer:
    image: "telegraf:1.19.1"
    container_name: "me-telegraf-producer"
    hostname: "me-telegraf-producer"
    environment:
      SERVICE_NAME: "me-telegraf-producer"
    volumes:
      - ./telegraf-producer.conf:/etc/telegraf/telegraf.conf:ro
    depends_on:
      - me-influxdb
      - me-rabbitmq
